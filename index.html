<!DOCTYPE html><!--cordova-->
<html>
<head>
	<title>WJFW TV-12</title>
	
	<!--Include PhoneGap API--->
	<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
	
	<!--Apple Web App Config --->
	<!--<link rel="apple-touch-icon" href="icon_57.png" />
	<link rel="apple-touch-icon" sizes="72x72" href="icon_72.png" />
	<link rel="apple-touch-icon" sizes="114x114" href="icon_114.png" />
	<meta name="apple-mobile-web-app-capable" content="yes" />-->
	
	<!--Mobile Screen Config-->
	<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1"> 
	
	<!--JQuery Mobile Init-->
	<link rel="stylesheet" href="css/jquery.mobile-1.4.2.min.css" />
	<script src="js/jquery-2.0.3.min.js"></script>
	<script src="js/jquery.mobile-1.4.2.min.js"></script>
	
	<script src="mejs/mediaelement-and-player.min.js"></script>
	<link rel="stylesheet" href="mejs/mediaelementplayer_forcepng.css" />
	<!--<script src="mejs/mep-feature-ads.js"></script>--> <!--extend for preroll ads-->
	
	<!--Vex Dialogs--->
	<script src="js/vex.combined.min.js"></script>
	<script>vex.defaultOptions.className = 'vex-theme-os';</script>
	<link rel="stylesheet" href="css/vex.css" />
	<link rel="stylesheet" href="css/vex-theme-os.css" />
	
	<!--PanZoom For Radar--->
	<script src="js/jquery.panzoom.min.js"></script>
	
	<!--WJFW_App CSS-->
	<link rel="stylesheet" href="css/wjfwapp_styles.css" />
	
	<style>
		.mejs-container {
		  /* Create some space below the player for the controls to move into. */
		  margin-bottom: 30px;
		}

		.mejs-container .mejs-controls {
		  /* Move the controls into the space below the player. */
		  bottom: -30px;
		}
		
		.btnbg_blue {
			background: rgb(79,133,187);
			background: -moz-linear-gradient(top, rgba(79,133,187,1) 0%, rgba(34,107,181,1) 100%);
			background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(79,133,187,1)), color-stop(100%,rgba(34,107,181,1)));
			background: -webkit-linear-gradient(top, rgba(79,133,187,1) 0%,rgba(34,107,181,1) 100%);
			background: -o-linear-gradient(top, rgba(79,133,187,1) 0%,rgba(34,107,181,1) 100%);
			background: -ms-linear-gradient(top, rgba(79,133,187,1) 0%,rgba(34,107,181,1) 100%);
			background: linear-gradient(to bottom, rgba(79,133,187,1) 0%,rgba(34,107,181,1) 100%);
			filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#4f85bb', endColorstr='#226bb5',GradientType=0 );
		}
		.btnbg_blueclick {
			background: rgb(128,167,206);
			background: -moz-linear-gradient(top, rgba(128,167,206,1) 0%, rgba(77,149,221,1) 100%);
			background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(128,167,206,1)), color-stop(100%,rgba(77,149,221,1)));
			background: -webkit-linear-gradient(top, rgba(128,167,206,1) 0%,rgba(77,149,221,1) 100%);
			background: -o-linear-gradient(top, rgba(128,167,206,1) 0%,rgba(77,149,221,1) 100%);
			background: -ms-linear-gradient(top, rgba(128,167,206,1) 0%,rgba(77,149,221,1) 100%);
			background: linear-gradient(to bottom, rgba(128,167,206,1) 0%,rgba(77,149,221,1) 100%);
			filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#80a7ce', endColorstr='#4d95dd',GradientType=0 );
		}
		.loclistitem {
			width:100%;
			border:1px solid #333333;
			border-radius:7px;
			margin:3px 0px;
			color: #FFFFFF;
			font-size:18px;
			font-weight:bold;
			text-align:center;
		}
	</style>
	
	
<script>
$(function() {
	setTimeout(function(){testconnection();},600);
	//setTimeout(function(){initapp();},800);
	
	$("#appcontents").css("visibility","hidden");
	
	//create global variables and info objects
	var appsettings = new Object();
	var deviceinfo = new Object();
	var datatream = new Object();
	var popwindows = new Object();
	
	appsettings.myappversion = "1.0";
	
	
	function initapp() {
		
		
		$("#appcontents").css("visibility","visible");
		$("#initloadingspinner").css("visibility","hidden");
		
		appsettings.imgcompressionratio = 90;
		appsettings.veiwport_w = $(window).width();
		appsettings.veiwport_h= $(window).height();
		//console.log("viewport: "+appsettings.veiwport_w+" - "+appsettings.veiwport_h);
		if (appsettings.connectioncheck) { $.getJSON("http://www.wjfw.com/appcontent/videoads.html", function(data) {
			console.log(data)
			appsettings.videoads = data;
		}); };
		//appsettings.videoads = vidadsraw.responceText
		console.log(appsettings.videoads);
		
		//Create Device Info Object
		deviceinfo.model = device.model;
		deviceinfo.platform = device.platform;
		deviceinfo.name = device.name;
		deviceinfo.version = device.version;
		deviceinfo.uuid = device.uuid;	
		
		//alert(appsettings.connectioncheck);
		if (appsettings.connectioncheck) {
			//alert('regcheck running');
			//check for registration, if none register device
			console.log("registation check");
			//console.log("http://www.wjfw.com/appcontent/appreg.html?q=checkreg&_uuid="+deviceinfo.uuid);
			$.getJSON("http://www.wjfw.com/appcontent/appreg.html?q=checkreg&_uuid="+deviceinfo.uuid, function(data) {
				console.log(data.returndata);
				if (data.returndata.uuid == "NOTFOUND") {
					appsettings.isreg = false;
					console.log("none found - register new account");
					var regstring = "_uuid="+deviceinfo.uuid+"&_dmodel="+deviceinfo.model+"&_dplatform="+deviceinfo.platform+"&_dname="+deviceinfo.name+"&_dversion="+deviceinfo.version;
					$.getJSON("http://www.wjfw.com/appcontent/appreg.html?q=createreg&"+regstring, function(data) {
						console.log(data);
						if (data.returndata == deviceinfo.uuid) {
							appsettings.isreg = true;
							setTimeout(function() {
								vex.dialog.confirm({
									'message': '<b>Welcome!</b><br>We\'ve noticed this is your first time using the WJFW Mobile App. Would you like to set up your Home Location now?<br><i>(You can always do this later from the settings menu.)</i>',
									'callback': function(value) { if(value){changelocation();} else { vex.dialog.alert('Ok. We\'ll set up your Home Location later. At any time you can set/change your Home Location from the settings menu. (The gear icon in the top right of your screen)'); } }
								});
							},700);
						}
						else {
							console.log("failed to register new account");
						};
					});
				}
				else {
					appsettings.isreg = true;
					appsettings.homelocation = data.returndata.homelocation;
					appsettings.asksethome = data.returndata.asksethome;
					//alert(appsettings.homelocation);
					//alert(appsettings.asksethome);
					console.log("found registered user");
					if ((appsettings.homelocation == "")&&(appsettings.asksethome == "true")) {
						setTimeout(function() {
							vex.dialog.confirm({
								'message': 'We\'ve noticed you haven\'t set your Home Location yet. Would you like to do this now?<br><i>(You can always do this later from the settings menu.)</i>',
								'callback': function(value) {
									if(value){ changelocation(); }
									else {
										vex.dialog.open({
											'message': 'Ok. We\'ll set up your Home Location later. At any time you can set/change your Home Location from the settings menu. (The gear icon in the top right of your screen)',
											'input':'<input name="noshow" type="checkbox" value="noshow"> Don\'t show this message again',
											'buttons': [ $.extend({}, vex.dialog.buttons.YES, { text: 'Ok'}) ],
											'callback': function(data) {
												if (data.noshow == "noshow") {
													appsettings.asksethome = false;
													savesettings("asksethome");
												}
											}
										});
									}
								}
							});
						},700);
					}
					else {
						getcurtemperature();
					};
					
				}
			});
			
			//if no registration, and new user return
			/*if (!appsettings.isreg) {
				console.log("register new account");
				var regstring = "_uuid="+deviceinfo.uuid+"&_dmodel="+deviceinfo.model+"&_dplatform="+deviceinfo.platform+"&_dname="+deviceinfo.name+"&_dversion="+deviceinfo.version;
				$.getJSON("http://www.wjfw.com/appcontent/appreg.html?q=createreg&"+regstring, function(data) {
				console.log(data);
				if (data.returndata == deviceinfo.uuid) {
					appsettings.isreg = true;
				}
				else {
					console.log("failed to register new account");
				};
			});
			};*/
			
			
		};
		
		$(".adspace").each(function() {
			var adsku = $(this).data("sku"); var adfolder = $(this).data("folder"); var adtype = $(this).data("type");
			writeimg("adspace","[data-sku='"+adsku+"']",adfolder,adtype);
		});
		
		$("#pageheadercontent_master").clone().appendTo(".headerchild");
		$("#pg_index #pageheadercontent_master").find(".back_btn").hide();
		
		// RADAR SETUP AND RUN
		setTimeout(function() {
			for (i = 0; i < p; i++){
						   preLoad[i] = new Image();
						   preLoad[i].src = url + Pic[i];
			}
			
			runloop();
		},1000);
		
		$('.panzoom').panzoom();
	};
	
	
		//Check Connectino Function - checks the state of the internet conection available, and makes sure that a connection to WJFW can be established.
	function checkconnection() {
	console.log('checking connection');
		var networkState = navigator.connection.type;
		console.log(networkState);
		
		var states = {};
			states[Connection.UNKNOWN]  = 'Unknown connection';
			states[Connection.ETHERNET] = 'Ethernet connection';
			states[Connection.WIFI]     = 'WiFi connection';
			states[Connection.CELL_2G]  = 'Cell 2G connection';
			states[Connection.CELL_3G]  = 'Cell 3G connection';
			states[Connection.CELL_4G]  = 'Cell 4G connection';
			states[Connection.CELL]     = 'Cell generic connection';
			states[Connection.NONE]     = 'No network connection';

			//console.log('Connection type: ' + states[networkState]);
			//alert('Connection type: ' + states[networkState]);
			appsettings.connectionraw = networkState;
			appsettings.connectiontype = states[networkState];
		
		switch (networkState) {
			case Connection.UNKNOWN:
			case Connection.NONE:
				return false;
				break;
			default:
				return true;
				break;
		}
	}
	function checkupdate() {
		console.log("checking for update");
		$.getJSON("http://www.wjfw.com/appcontent/versioncheck.html", function(data) {
			if (appsettings.myappversion == data.version) {
				console.log("app up to date, proceed");
				initapp();
			}
			else {
				console.log("new version, fail");
				$("#appcontents").css("visibility","visible");
				$("#initloadingspinner").css("visibility","hidden");
				$.mobile.changePage("#pg_update");
			}
		});
	}


	window.testconnection = function () {
		appsettings.connectioncheck = checkconnection();
		if (appsettings.connectioncheck) {
			console.log('good connection, proceed');
			checkupdate();
		}
		else {
			console.log('bad connection, fail');
			$("#appcontents").css("visibility","visible");
			$("#initloadingspinner").css("visibility","hidden");
			$.mobile.changePage("#pg_noconnection");
		}
	}
	
	function changelocation() {
		//alert('change location function');
		var mywindow = vex.open({
			content: '<div is="vexlocationwindow" style="text-align:center;">Fetching Location...<br><Br><img src="img/220.GIF"></div>',
			showCloseButton: false,
			escapeButtonCloses: false,
			overlayClosesOnClick: false
		});
		
		navigator.geolocation.getCurrentPosition(function(position){
			//alert('fetch success');
			appsettings.mypos = position;
			//alert(appsettings.mypos.coords.latitude +", "+appsettings.mypos.coords.longitude);
			
			var loc_jhxr = fetchzipdata(appsettings.mypos.coords.latitude,appsettings.mypos.coords.longitude);
			loc_jhxr.done(function(data) {
				appsettings.homelocationsarray = data.returndata;
				vex.close(mywindow.data().vex.id);
				showlocationresults();
			});
		},function (error) {
			vex.close(mywindow.data().vex.id);
			vex.dialog.alert('There was an error retrieving your location.<br><br><i>Error Message: Code '+error.code+' - '+error.message);
		});
		
	}
	function showlocationresults() {
	//alert('running showresults');
	var contentstring = '<div is="vexlocationwindow" style="text-align:center;">Please choose your Home Location from the list below<br><table width="90%" style="margin:0px auto;"><tr><td>';
	for (x=0;x<5;x++) {
	//alert(decodeURI(appsettings.homelocationsarray[x].record.place));
		contentstring += '<div data-skuindex="'+x+'" class="loclistitem btnbg_blue">'+decodeURI(appsettings.homelocationsarray[x].record.place)+', '+appsettings.homelocationsarray[x].record.state+' '+appsettings.homelocationsarray[x].record.zipcode+'</div>';
	};
	contentstring += '</td></tr></table></div>';
	
	popwindows.loclistdata = contentstring;
	
		loclistwindowopen();
		
		$(document).on("click",".loclistitem", function() {
			$(this).addClass("btnbg_blueclick").removeClass("btnbg_blue");
			setTimeout(function() { $(this).removeClass("btnbg_blueclick").addClass("btnbg_blue"); },800);
			var mydatasku = $(this).data("skuindex");
			//alert(mydatasku);
			confirmloc(mydatasku);
		});
	}
	function loclistwindowopen() {
		popwindows.loclist = vex.dialog.open({
				message: popwindows.loclistdata,
				showCloseButton: false,
				escapeButtonCloses: false,
				overlayClosesOnClick: false,
				buttons: [
					 $.extend({}, vex.dialog.buttons.NO, { click: function($vexContent, event) {
						vex.close(popwindows.loclist.data().vex.id);
						popwindows.loclist = "";
						vex.dialog.open({
							'message': 'Ok. We\'ll set up your Home Location later. At any time you can set/change your Home Location from the settings menu. (The gear icon in the top right of your screen)',
							'input':'<input name="noshow" type="checkbox" value="noshow"> Don\'t show this message again',
							'buttons': [ $.extend({}, vex.dialog.buttons.YES, { text: 'Ok'}) ],
							'callback': function(data) {
								if (data.noshow == "noshow") {
									appsettings.asksethome = false;
									savesettings("asksethome");
								}
							}
						});
					}})
				]
			});
	}
	function confirmloc(skuindex) {
	vex.close(popwindows.loclist.data().vex.id);
		vex.dialog.confirm({
			message: 'Set Home Location As '+decodeURI(appsettings.homelocationsarray[skuindex].record.place)+', '+appsettings.homelocationsarray[skuindex].record.state+' '+appsettings.homelocationsarray[skuindex].record.zipcode+'?',
			callback: function(callbackval) {
				//alert(callbackval);
				if (callbackval) {
					appsettings.homelocation = appsettings.homelocationsarray[skuindex].record.zipcode;
					savesettings("homelocation");
					popwindows.loclist = ""; //clear window data
					vex.dialog.alert('Home Location Set!<br><i>(Remember you can always change it later from the settings menu.)</i>');
					getcurtemperature();
				}
				else {
					loclistwindowopen();
				}
			}
		});
	}
	function fetchzipdata(lat,lng) {
		return $.getJSON("http://www.wjfw.com/appcontent/geodata/pollgeodata.html?q=bycoord&lat="+lat+"&lng="+lng+"&radius=25&maxrecords=20");
	}
	
	function savesettings(setting) {
		//alert("http://www.wjfw.com/appcontent/appreg.html?q=savesettings&uuid="+deviceinfo.uuid+"&_"+setting+"="+eval("appsettings."+setting));
		$.getJSON("http://www.wjfw.com/appcontent/appreg.html?q=savesettings&uuid="+deviceinfo.uuid+"&_"+setting+"="+eval("appsettings."+setting), function(data) {
			console.log("save settings - "+data.returndata)
		}); 
	}
	
	function getcurtemperature() {
		console.log('get temp');
		var weathertempcontent = "";
		//alert(appsettings.homelocation);
		if (appsettings.homelocation == "") {
			console.log("no go");
			weathertempcontent = "<div style='width:100%;text-align:center;font-weight:bold;font-size:18px;'>Please set up your Home Location to use this feature.</div>";
			$("#main_curweather").html(weathertempcontent);
			$("#weather_curweather").html(weathertempcontent);
			$("#homelocationtext").html("<b>No Location Set</b>");
		}
		else {
			console.log("fetching content");
			$.getJSON("http://www.wjfw.com/appcontent/apploaddata.html?loaddatatype=curweather&q="+appsettings.homelocation, function(data) {
				appsettings.homelocationweather = data.returndata;
				weathertempcontent += "Current Temperature for <b>"+data.returndata.city+" <i>("+appsettings.homelocation+")</i></b>:<br>";
				weathertempcontent += "<img src='http://www.wjfw.com/appcontent/loadimage.php?orgsrc=weather/icons/"+data.returndata.weathericon+".png&setres="+appsettings.imgcompressionratio+"' style='float:left;margin-right:5px;'>";
				weathertempcontent += "<span style='font-size:20px;font-weight:bold;'>"+data.returndata.temperature+"&deg;</span><br>";
				weathertempcontent += "<i>RealFeel "+data.returndata.realfeel+"&deg;</i><br style='clear:both;'>Windspeed "+data.returndata.windspeed+"mph "+data.returndata.winddirection+"<br>";
				$("#main_curweather").html(weathertempcontent);
				$("#weather_curweather").html(weathertempcontent);
				$("#homelocationtext").html("<b>"+data.returndata.city+" <i>("+appsettings.homelocation+")</i></b>");
			}).fail(function(jqxhr,textstatus,error){
				var err = textstatus + ", " + error;
				console.log("Request Failed: "+err);
				weathertempcontent = "<div style='width:100%;text-align:center;font-weight:bold;font-size:18px;'>There was an error fetching weather data.</div>";
				$("#main_curweather").html(weathertempcontent);
				$("#weather_curweather").html(weathertempcontent);
				$("#homelocationtext").html("<b>"+appsettings.homelocation+"</b>");
			});
		}
	}
	
		//Load Data Function - will send to process data function
	window.loaddata = function (datatype,displaytype,query,maxrecords,beginat,contentbox) {
		console.log('fetching '+datatype+'-'+displaytype);
		
		$(contentbox).html("<img src='img/220.GIF'>");
		
		var searchstring = 'loaddatatype='+datatype+'&displaytype='+displaytype+'&contentbox='+contentbox+'&q='+query+'&maxrecords='+maxrecords+'&beginat='+beginat;
		if (appsettings.connectioncheck) { //disable all requests if bad connection
			jQuery.ajax({
			  type: "GET",
			  url: "http://www.wjfw.com/appcontent/apploaddata.html",
			  dataType: "json",
			  data: searchstring,
			  success: processdata,
			  error: function (xhr, txtStatus, thrownError) {
				console.log(xhr.status);
				console.log(txtStatus);
				console.log(thrownError);
				console.log(searchstring);
			  }
			});
		};
	};
	
		//Process Data Function - recieves loaded data from loaddata() function, then formats and displays the data acordingly
	function processdata(data) {
		console.log("processing response");
		//datastream = $.parseJSON(data);
		datastream = data;
		
		console.log(datastream.datatype);
		switch (datastream.datatype) {
			case "stories" :
				//process story data
				console.log(datastream.displaytype);
				switch (datastream.displaytype) {
					case "topstory" :
						console.log(datastream.contentbox);
						console.log(decodeURIComponent(datastream.returndata[0].record.STORYTITLE));
						var returncontent = "<div class='topstorycontainer'><div class='title'>"+decodeURIComponent(datastream.returndata[0].record.STORYTITLE)+"</div>";
						returncontent += "<div class='photocontainer'><img src='http://www.wjfw.com/appcontent/loadimage.php?orgsrc=Photos/"+datastream.returndata[0].record.PHOTO1+"&setres="+appsettings.imgcompressionratio+"'></div>";
						returncontent += "<div class='snippitcontainer'><b>"+decodeURIComponent(datastream.returndata[0].record.LOCATION)+"</b> - "+decodeURIComponent(datastream.returndata[0].record.PARAGRAPH1)+"</div>";
						returncontent += "<a data-passsku='"+decodeURIComponent(datastream.returndata[0].record.SKU)+"' class='ui-btn ui-btn-inline ui-icon-carat-r ui-btn-icon-right ui-mini readmorebtn'>Read More</a>"
						returncontent += "</div>"
						$("#"+datastream.contentbox).html(returncontent);
						break;
						
					case "headlines" :
						var returncontent = "<div class='headlinescontainer'>";
							$.each(datastream.returndata, function(key,val) {
								var dataobj = val;
								if (parseInt(dataobj.index)%2) { returncontent += "<div class='rowcontainer'>"; };
								returncontent += "<div class='item readmorebtn' data-passsku='"+decodeURIComponent(dataobj.record.SKU)+"'>";
								returncontent += "<div class='photocontainer'><img src='http://www.wjfw.com/appcontent/loadimage.php?orgsrc=Photos/"+dataobj.record.PHOTO1+"&setres="+appsettings.imgcompressionratio+"'></div>";
								returncontent += "<a  data-passsku='"+decodeURIComponent(dataobj.record.SKU)+"' class='ui-btn ui-btn-inline ui-mini ui-icon-carat-r ui-btn-icon-right ui-mini readmorebtn' style='float:right;'></a>";
								returncontent += "<div class='title'>"+decodeURIComponent(dataobj.record.STORYTITLE)+"</div>";
								returncontent += "</div>";
								if (parseInt(dataobj.index)%2) { returncontent += "<div class='rowspacer'></div>"; } else { returncontent += "</div><div style='clear:both;'></div>"; };
							});
						returncontent += "</div><div style='clear:both;'></div>"
						$("#"+datastream.contentbox).html(returncontent);
						break;
						
					case "storydetails" :
						var returncontent = "<div class='storydetailscontainer'><div class='title'>"+decodeURIComponent(datastream.returndata[0].record.STORYTITLE)+"</div>";
						returncontent += "<div class='creditcontainer'>Submitted "+decodeURIComponent(datastream.returndata[0].record.STORYDATE)+"<br>Story By: "+decodeURIComponent(datastream.returndata[0].record.AUTHOR)+"</div>";
						returncontent += "<div class='photocontainer'><img src='http://www.wjfw.com/appcontent/loadimage.php?orgsrc=Photos/"+datastream.returndata[0].record.PHOTO1+"&setres="+appsettings.imgcompressionratio+"'></div>";
						returncontent += "<div class='contentcontainer'><b>"+decodeURIComponent(datastream.returndata[0].record.LOCATION)+"</b> - "+decodeURIComponent(datastream.returndata[0].record.PARAGRAPH1)+"<br>"+decodeURIComponent(datastream.returndata[0].record.PARAGRAPH2)+"<br>"+decodeURIComponent(datastream.returndata[0].record.PARAGRAPH3)+"</div><br><br>";
						returncontent += "</div>"
						$("#"+datastream.contentbox).html(returncontent);
						break;
				}
				break;
			case "weather" :
				//process weather data
				console.log(datastream.displaytype);
				switch (datastream.displaytype) {
					case "highlights" :
						var returncontent = "<div class='weatherhighlightscontainer'><div class='title'>"+decodeURIComponent(datastream.returndata[0].record.TITLE)+"</div>";
						returncontent += "<div class='text'>"+decodeURIComponent(datastream.returndata[0].record.TEXT)+"</div></div>";
						$("#"+datastream.contentbox).html(returncontent);
						break;
				}
				break;
			case "videolist" :
				var returncontent = "";
				for (x=0;x<10;x++) {
					
					returncontent += "<div class='viditem'><b>"+decodeURIComponent(datastream.returndata[x].title)+"</b>";
					returncontent += "<div class='photocontainer'><img src='http://cdn.bimvid.com/WJFW/"+decodeURIComponent(datastream.returndata[x].guid)+".jpg'></div>";
					returncontent += "<a data-passsku='"+decodeURIComponent(datastream.returndata[x].guid)+"' class='ui-btn ui-btn-inline ui-mini ui-icon-carat-r ui-btn-icon-right ui-mini videobtn' style='float:left;margin-right:6px;'>Play Video</a><span style='clear:both;'></span></div>";
					$("#"+datastream.contentbox).html(returncontent);
				}
				break;
			default :
				//error - nonexistant function
				break;
		}
	}

	$(document).on("click",".readmorebtn", function() {
		console.log('running click event for readmore');
		$.mobile.changePage("#pg_storydetails");
		var passsku = $(this).data("passsku");
		loaddata("stories","storydetails",encodeURIComponent("eqskudatarq="+passsku),1,1,"main_storydetails");
	});
	
	$(document).on("click",".changelocationbtn", function() {
		changelocation();
	});
	
	var videoplayer = null;
	
	$(document).on("click",".videobtn", function() {
		console.log('running click event for video');
		$.mobile.changePage("#pg_videoplayer");
		var passsku = $(this).data("passsku");
		var filename = 'http://cdn.bimvid.com/WJFW/'+passsku+'_fl9.mp4';
		//alert(passsku);
		//alert(filename);
		//create video player
		//videoplayer.setSrc(filename);
		//videoplayer.play();
		
		//VideoPlayer.play(filename);
		
		var playerwidth = appsettings.veiwport_w - 30;
		var playerheight = playerwidth / (4/3);
		
		$("#videoplayercontainer").html('<video id="player" src="http://cdn.bimvid.com/WJFW/'+passsku+'_fl9.mp4" poster="http://cdn.bimvid.com/WJFW/'+passsku+'.jpg" preload="none" width="'+playerwidth+'" height="'+playerheight+'" controls></video>');
		
		
		
		videoplayer = new MediaElementPlayer('#player',{
		AndroidUseNativeControls: false,
		features: ['playpause','progress','current','duration','volume','fullscreen'],
		alwaysShowControls: true,
		success : function(mediaobj, domobj) {
			var thismediaobj = mediaobj;
			var playad = true;
			var adcanplay = true;
			var orgsrc;
			//console.log("success event");
			
			mediaobj.addEventListener('playing',function() {	//IsPlaying Event Listener
				//console.log("play event");
				//console.log(playad + " - " + adcanplay);
				if (playad && adcanplay) {
					adcanplay = false;
					//console.log("play ad");
					thismediaobj.pause();
					orgsrc = thismediaobj.src;
					//console.log("ADVERT SRC: "+appsettings.videoads.addarray[Math.floor(Math.random()*appsettings.videoads.addarray.length)].vidurl);
					thismediaobj.setSrc(appsettings.videoads.addarray[Math.floor(Math.random()*appsettings.videoads.addarray.length)].vidurl);
					thismediaobj.load();
					thismediaobj.play();
				}	
			}, false);
			
			mediaobj.addEventListener('ended',function() {	//IsEnded Event Listener
				//console.log("end event");
				//console.log(playad);
				if (playad) {
					//console.log("load media");
					playad = false;
					thismediaobj.setSrc(orgsrc);
					thismediaobj.load();
					thismediaobj.play();
				}
			}, false);
		}
		});
		
	});

	window.writeimg = function (content,objbox,arg1,arg2) {
	if (appsettings.connectioncheck) { //disable all requests if bad connection
		switch (content) {
			case "w_7days" :
				$(objbox).html("<img src='http://www.wjfw.com/appcontent/loadimage.php?orgsrc=weather/menu/UploadGraphic/media2/panel02.jpg&setres="+appsettings.imgcompressionratio+"' style='max-width:100%;'>");
				break;
			case "w_radar" :
				$(objbox).html("<img src='http://www.wjfw.com/appcontent/loadimage.php?orgsrc=accuwx/radarwi.png&setres="+appsettings.imgcompressionratio+"' style='max-width:100%;' id='radarslides' name='radarslides'>");
				break;
			case "adspace" :
				$(objbox).html("<img src='http://www.wjfw.com/appcontent/loadimage.php?orgsrc=appcontent/bannerads/"+arg1+"/"+arg2+".jpg&setres="+appsettings.imgcompressionratio+"' style='max-width:100%;'>");
				break;
		}
	};
	};
	
	
	/*var backbtnshowing = false;
	$(document).on('pagechange', '[data-role="page"]', function(){
		if (history.length>1) { if (!backbtnshowing) { $('.back_btn').show();backbtnshowing=true; }; } else {$('.back_btn').hide();backbtnshowing=false;} //Contols the back btn
	});*/
	
	$(document).on('pagebeforecreate', '[data-role="page"]', function(){   
		$("#navpanel").clone().appendTo($(this));
		$(this).find('#navpanel').panel();
		$("#settings").clone().appendTo($(this));
		$(this).find('#settings').panel();
		
		//pause video on page change if playing
		console.log(videoplayer);
		if (videoplayer != null) {
			console.log(videoplayer.media.playing);
			if (videoplayer.media.playing) {
				videoplayer.media.pause();
				console.log('video paused');
			}
		}
	});
	
		$(document).on('click', '.navpannel_btn', function(){   
			 $.mobile.activePage.find('#navpanel').panel("open");       
		});
		$(document).on('click', '.settingspannel_btn', function(){   
			 $.mobile.activePage.find('#settings').panel("open");       
		});  
		
		//hide back button on home page
		//$('#pageheadercontent_master #headercontainer .back_btn').hide();
	
	//loadimage.php?orgsrc=accuwx/radarwi.png&setres="+appsettings.imgcompressionratio+"
	
	
	var k=0;
	var speed = 250;
	var Pic = new Array();
	Pic[0] = 'accuwx/radarwi1.png';
	Pic[1] = 'accuwx/radarwi2.png';
	Pic[2] = 'accuwx/radarwi3.png';
	Pic[3] = 'accuwx/radarwi4.png';
	Pic[4] = 'accuwx/radarwi5.png';
	Pic[5] = 'accuwx/radarwi6.png';
	Pic[6] = 'accuwx/radarwi7.png';
	Pic[7] = 'accuwx/radarwi8.png';
	Pic[8] = 'accuwx/radarwi9.png';

	var url = "http://www.wjfw.com/";
	var t;
	var j = 0;
	var p = Pic.length;
	var preLoad = new Array();
	/*for (i = 0; i < p; i++){
               preLoad[i] = new Image();
               preLoad[i].src = url + Pic[i];
	}*/
	window.runSlideShow = function(){
				   document.images.radarslides.src = preLoad[j].src;
				   j = j + 1;
				   if (j > (p-1) )  j = 0;
				   t = setTimeout('runSlideShow()', speed);
	}
	window.runloop = function (){runSlideShow();console.log('radar runloop running');}

	
});
</script>

	

	
</head>
<body marginheight="0" marginwidth="0" topmargin="0">

<img src='img/220.GIF' id="initloadingspinner">

<div id="appcontents">
<div data-role="page" id="pg_index">

<div data-role="panel" id="navpanel" class="fixpanel" data-position="right" data-display="push" data-dismissible="true" data-theme="a">

<ul data-role="listview">
	<li data-role="list-divider">Navigation</li>
    <li><a href="#pg_news">News</a></li>
    <li><a href="#pg_sports">Sports</a></li>
    <li><a href="#pg_weather">Weather</a></li>
    <li><a href="#pg_radar">Radar</a></li>
    <li><a href="#pg_videomain">Video</a></li>
</ul>

</div><!-- /panel -->
<div data-role="panel" id="settings" class="fixpanel" data-position="right" data-display="push" data-dismissible="true" data-theme="a">
<ul data-role="listview">

	<li data-role="list-divider">Settings</li>
    <li><a href="#pg_homelocationsettings">Change Home Location</a></li>
    <!--<li><a href="#">Notifications</a></li>
	<li><a href="#">Contact Us</a></li>-->
</ul>
</div><!-- /panel -->

<div id="pageheadercontent_master">



<div id="headercontainer" data-role="header" data-position="fixed" data-id="header">
	<img src="img/logo_lrg.fw.png" style="position:absolute;top:-5px;left:0px;border:0px;">
	<!--<img src="img/tempoverlay.fw.png" style="position:absolute;top:6px;right:150px;">-->
	<div data-role="controlgroup" data-type="horizontal" data-mini="true" style="position:absolute;top:3px;right:10px;">
	<a href="#pg_index" data-role="button" data-icon="home" data-iconpos="notext" data-inline="true" data-theme="b">Home</a>
	<a href="#" class="settingspannel_btn" data-role="button" data-icon="gear" data-iconpos="notext" data-inline="true" data-theme="b">Settings</a>
	<a href="#" class="navpannel_btn" data-role="button" data-icon="bars" data-iconpos="notext" data-inline="true" data-theme="b">Navigation</a>
	</div>
	<div style="position:absolute;right:5px;top:48px;"><a href="javascript:history.go(-1);" class="back_btn ui-btn ui-btn-inline ui-mini ui-icon-back ui-btn-icon-left">Back</a></div>
</div>
</div>
<div data-role="content">
<h3 class="ui-bar ui-bar-a ui-corner-all" style="margin:2px 0px;"><span class="ui-icon-carat-r ui-btn-icon-left " style="position:relative;" />Current Weather</h3>
<div style="clear:both;height:8px;"></div>
<div id="main_curweather"><img src="img/255.GIF" align="center"></div>
<h3 class="ui-bar ui-bar-a ui-corner-all" style="margin:2px 0px;"><span class="ui-icon-carat-r ui-btn-icon-left " style="position:relative;" />Top Story</h3>
<div style="clear:both;height:8px;"></div>
<div id="main_topstory"><img src="img/255.GIF" align="center"></div>

<div style="height:8px;clear:both;"></div>
<div class="adspace" data-sku="101" data-folder="fleetfarm" data-type="300x100"></div>
<div style="height:8px;clear:both;"></div>
<div id="topmoreheadlines"><img src="img/255.GIF" align="center"></div>
<div style="height:8px;clear:both;"></div>
<div class="adspace" data-sku="102" data-folder="fleetfarm" data-type="300x100"></div>
<div style="height:8px;clear:both;"></div>


<div style="height:8px;clear:both;"></div>
<script>$(function() {
setTimeout(function(){
loaddata("stories","topstory",encodeURIComponent("eqADD1datarq=yes&STORYDATEtype=date&STORYDATEsort=1&STORYDATEsdir=de"),1,1,"main_topstory");
loaddata("stories","headlines",encodeURIComponent("eqADD1datarq=yes&STORYDATEtype=date&STORYDATEsort=1&STORYDATEsdir=de"),4,2,"topmoreheadlines");
},1000);
});</script>


</div>
</div>



<div data-role="page" id="pg_storydetails">

<div class="headerchild"></div>
<div data-role="content">
<div class="adspace" data-sku="201" data-folder="fleetfarm" data-type="320x50_playdate"></div>
<div style="height:8px;clear:both;"></div>
<div id="main_storydetails"><img src="img/255.GIF" align="center"></div>
<div style="height:8px;clear:both;"></div>
<div class="adspace" data-sku="202" data-folder="fleetfarm" data-type="320x50_playdate"></div>

</div>
</div>


<div data-role="page" id="pg_news">

<div class="headerchild"></div>
<div data-role="content">

<h3 class="ui-bar ui-bar-a ui-corner-all" style="margin:2px 0px;"><span class="ui-icon-carat-r ui-btn-icon-left " style="position:relative;" />Local News Headlines</h3>
<div style="clear:both;height:8px;"></div>
<div id="main_localnews"><img src="img/255.GIF" align="center"></div>
<div style="height:8px;clear:both;"></div>
<div class="adspace" data-sku="301" data-folder="fleetfarm" data-type="320x50_playdate"></div>
<div style="height:8px;clear:both;"></div>
<h3 class="ui-bar ui-bar-a ui-corner-all" style="margin:2px 0px;"><span class="ui-icon-carat-r ui-btn-icon-left " style="position:relative;" />Regional News Headlines</h3>
<div style="clear:both;height:8px;"></div>
<div id="main_regionalnews"><img src="img/255.GIF" align="center"></div>
<div style="height:8px;clear:both;"></div>
<div class="adspace" data-sku="302" data-folder="fleetfarm" data-type="300x100"></div>
<script>$(function() {
setTimeout(function(){
loaddata("stories","headlines",encodeURIComponent("eqMAINCATdatarq=General News&eqSUBCATdatarq=Local News&STORYDATEtype=date&deSTORYDATEsort=1&deADD3sort=2"),8,1,"main_localnews");
loaddata("stories","headlines",encodeURIComponent("eqMAINCATdatarq=General News&eqSUBCATdatarq=Regional News&STORYDATEtype=date&deSTORYDATEsort=1&deADD3sort=2"),8,1,"main_regionalnews");
},1000);
});</script>

</div>

</div>


<div data-role="page" id="pg_sports">

<div class="headerchild"></div>
<div data-role="content">

<h3 class="ui-bar ui-bar-a ui-corner-all" style="margin:2px 0px;"><span class="ui-icon-carat-r ui-btn-icon-left " style="position:relative;" />Local Sports Headlines</h3>
<div style="clear:both;height:8px;"></div>
<div id="main_localsports"><img src="img/255.GIF" align="center"></div>
<div style="height:8px;clear:both;"></div>
<div class="adspace" data-sku="401" data-folder="fleetfarm" data-type="320x50_playdate"></div>
<div style="height:8px;clear:both;"></div>
<h3 class="ui-bar ui-bar-a ui-corner-all" style="margin:2px 0px;"><span class="ui-icon-carat-r ui-btn-icon-left " style="position:relative;" />Regional Sports Headlines</h3>
<div style="clear:both;height:8px;"></div>
<div id="main_regionalsports"><img src="img/255.GIF" align="center"></div>
<div style="height:8px;clear:both;"></div>
<div class="adspace" data-sku="402" data-folder="fleetfarm" data-type="300x100"></div>
<script>$(function() {
setTimeout(function(){
loaddata("stories","headlines",encodeURIComponent("eqMAINCATdatarq=Sports&eqSUBCATdatarq=Local News&STORYDATEtype=date&deSTORYDATEsort=1&deADD3sort=2"),8,1,"main_localsports");
loaddata("stories","headlines",encodeURIComponent("eqMAINCATdatarq=Sports&eqSUBCATdatarq=Regional News&STORYDATEtype=date&deSTORYDATEsort=1&deADD3sort=2"),8,1,"main_regionalsports");
},1000);
});</script>

</div>

</div>


<div data-role="page" id="pg_weather">

<div class="headerchild"></div>
<div data-role="content">
<h3 class="ui-bar ui-bar-a ui-corner-all" style="margin:2px 0px;"><span class="ui-icon-carat-r ui-btn-icon-left " style="position:relative;" />Current Weather</h3>
<div style="clear:both;height:8px;"></div>
<div id="weather_curweather"><img src="img/255.GIF" align="center"></div>
<h3 class="ui-bar ui-bar-a ui-corner-all" style="margin:2px 0px;"><span class="ui-icon-carat-r ui-btn-icon-left " style="position:relative;" />7 Day Forcast</h3>
<div id="7daycontainer">
<script>$(function() { setTimeout(function(){writeimg("w_7days","#7daycontainer");},1000); });</script>
</div>
<div style="height:8px;clear:both;"></div>
<div class="adspace" data-sku="501" data-folder="fleetfarm" data-type="300x100"></div>
<div style="height:8px;clear:both;"></div>
<h3 class="ui-bar ui-bar-a ui-corner-all" style="margin:2px 0px;"><span class="ui-icon-carat-r ui-btn-icon-left " style="position:relative;" />Weather Highlights</h3>
<div style="clear:both;height:8px;"></div>
<div id="main_weatherhighlights"><img src="img/255.GIF" align="center"></div>
<script>$(function() {
setTimeout(function(){
loaddata("weather","highlights","",1,1,"main_weatherhighlights");
},1000);
});</script>


</div>

</div>


<div data-role="page" id="pg_radar">

<div class="headerchild"></div>
<div data-role="content">

<h3 class="ui-bar ui-bar-a ui-corner-all" style="margin:2px 0px;"><span class="ui-icon-carat-r ui-btn-icon-left " style="position:relative;" />Radar</h3>
<div id="radarcontainer" style="width:98%;margin:5px auto;text-align:center;" class="panzoom"><img src="img/255.GIF"></div>
<!--<script>$(function() {
setTimeout(function() { $("#radarcontainer").html('<iframe width="'+$("#radarcontainer").width()+'" scrolling="false" frameborder="0" height="320" name="1" src="http://wviimaps.accuweather.com/adc2004/common/includes/maptiles/maptiles-h.asp?zm=6&lat=44.80&lon=-88.50&w='+$("#radarcontainer").width()+'&h=320&css=018CCF|007FC0|018CCF|007FC0#"></iframe>'); },2000);
});</script>-->
<script>$(function() { setTimeout(function(){writeimg("w_radar","#radarcontainer");},1000); });</script>


<div style="height:8px;clear:both;"></div>
<div class="adspace" data-sku="601" data-folder="fleetfarm" data-type="320x50_playdate"></div>
</div>
</div>

<div data-role="page" id="pg_videomain">

<div class="headerchild"></div>
<div data-role="content">

<div style="height:8px;clear:both;"></div>
<div class="adspace" data-sku="701" data-folder="fleetfarm" data-type="320x50_playdate"></div>
<div style="height:8px;clear:both;"></div>

<h3 class="ui-bar ui-bar-a ui-corner-all" style="margin:2px 0px;"><span class="ui-icon-carat-r ui-btn-icon-left " style="position:relative;" />WJFW Mobile Video</h3>

<div id="videolistcontainer">
<!--<div class='viditem'><b>Test Video</b>
=<div class='photocontainer'><img src='http://cdn.bimvid.com/WJFW/6698edd380099295407e8f18bc771375897f76d3.jpg'></div>
<a data-passsku='6698edd380099295407e8f18bc771375897f76d3' class='ui-btn ui-btn-inline ui-mini ui-icon-carat-r ui-btn-icon-right ui-mini videobtn' style='float:left;margin-right:6px;'>Play Video</a><span style='clear:both;'></span></div>-->
</div>
<script>$(function() {
setTimeout(function(){
loaddata("videolist","","a248d92ab658bd6fc81a965e0e6af7939af56117",0,0,"videolistcontainer");
},1000);
});</script>



</div>

</div>


<div data-role="page" id="pg_videoplayer">

<div class="headerchild"></div>
<div data-role="content">


<div id="videoplayercontainer">

</div>


</div>

</div>

<div data-role="page" id="pg_noconnection">

<div id="headercontainer" data-role="header" data-position="fixed" data-id="header">
	<img src="img/logo_lrg.fw.png" style="position:absolute;top:-5px;left:0px;">
</div>
<div data-role="content">


<h2 style="text-align:center;">We're Sorry :(</h2>
<div style="text-align:center;">
It seems you have no connection to the internet. Please connect your device to a wifi or cell data source to use the WJFW Mobile App.
</div>

</div>

</div>

<div data-role="page" id="pg_update">

<div id="headercontainer" data-role="header" data-position="fixed" data-id="header">
	<img src="img/logo_lrg.fw.png" style="position:absolute;top:-5px;left:0px;">
</div>
<div data-role="content">


<h2 style="text-align:center;">New Version Available</h2>
<div style="text-align:center;">
It seems you do not have the current version of the WJFW Mobile App. Please update your app to the newest version to continue using the WJFW Mobile App.
</div>

</div>

</div>

<div data-role="page" id="pg_homelocationsettings">

<div class="headerchild"></div>
<div data-role="content">


<h2 style="text-align:center;">Home Location Settings</h2>
<div style="text-align:center;">
Current Home Location: <span id="homelocationtext"></span><br>
<br>
<a class='ui-btn ui-btn-inline ui-mini ui-icon-carat-r ui-btn-icon-right ui-mini changelocationbtn'>Change Home Location</a>
</div>

</div>

</div>


</div>

</body>
</html>