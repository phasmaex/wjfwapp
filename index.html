<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--HAS_WEBDNA_TAGS-->
<html>
<head>
	<title>WJFW TV-12</title>
	
	<!--Include PhoneGap API--->
	<script src="phonegap.js"></script>
	
	<!--Apple Web App Config --->
	<link rel="apple-touch-icon" href="icon_57.png" />
	<link rel="apple-touch-icon" sizes="72x72" href="icon_72.png" />
	<link rel="apple-touch-icon" sizes="114x114" href="icon_114.png" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	
	<!--Mobile Screen Config-->
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	
	<!--JQuery Mobile Init-->
	<link rel="stylesheet" href="css/jquery.mobile-1.4.2.min.css" />
	<script src="js/jquery-1.10.2.min.js"></script>
	<script src="js/jquery.mobile-1.4.2.min.js"></script>
	
	
<script>
$(function() {
		//Check Connectino Function - checks the state of the internet conection available, and makes sure that a connection to WJFW can be established.
	/*function checkconnection() {
		var networkState = navigator.network.connection.type;
		
		 var states = {};
			states[Connection.UNKNOWN]  = 'Unknown connection';
			states[Connection.ETHERNET] = 'Ethernet connection';
			states[Connection.WIFI]     = 'WiFi connection';
			states[Connection.CELL_2G]  = 'Cell 2G connection';
			states[Connection.CELL_3G]  = 'Cell 3G connection';
			states[Connection.CELL_4G]  = 'Cell 4G connection';
			states[Connection.NONE]     = 'No network connection';

			console.log('Connection type: ' + states[networkState]);

		
		switch (networkState) {
			case Connection.UNKNOWN:
			case Connection.NONE:
				return false;
				break;
			default:
				return true;
				break;
		}
	}*/
	
	var appsettings = new Object();
		
		appsettings.imgcompressionratio = 90;
	
	
	var datatream = new Object();
		//Load Data Function - will send to process data function
	function loaddata(datatype,displaytype,query,contentbox) {console.log('fetching '+datatype+'-'+displaytype);
	
	jQuery.ajax({
      type: "GET",
      url: "http://www.wjfw.com/appcontent/apploaddata.html",
      dataType: "json",
      data: 'loaddatatype='+datatype+'&displaytype='+displaytype+'&contentbox='+contentbox+'&q='+query,
      success: processdata,
      error: function (xhr, txtStatus, thrownError) {
        console.log(xhr.status);
        console.log(txtStatus);
		console.log(thrownError);
      }
    });
	
	//$.get('http://www.wjfw.com/appcontent/apploaddata.html?loaddatatype='+datatype+'&displaytype='+displaytype+'&contentbox='+contentbox+'&q='+query,processdata,"json").done(function() {console.log( "loaded" );}).fail(function(event,xhr,options,exc) { console.log( "error: " + xhr.status +" - "+xhr.responseText+" - "+exc);}).always(function() {console.log( "finished" );});
	
	}
		//Process Data Function - recieves loaded data from loaddata() function, then formats and displays the data acordingly
	function processdata(data) {
		console.log("processing response");
		//datastream = $.parseJSON(data);
		datastream = data;
		
		console.log(datastream.datatype);
		switch (datastream.datatype) {
			case "stories" :
				//process story data
				console.log(datastream.displaytype);
				switch (datastream.displaytype) {
					case "topstory" :
						console.log(datastream.contentbox);
						console.log(decodeURIComponent(datastream.returndata.record.STORYTITLE));
						var returncontent = "<div class='topstorycontainer'><div class='title'>"+decodeURIComponent(datastream.returndata.record.STORYTITLE)+"</div>";
						returncontent += "<div class='photocontainer'><img src='http://www.wjfw.com/appcontent/loadimage.php?orgsrc=Photos/"+datastream.returndata.record.PHOTO1+"&setres="+appsettings.imgcompressionratio+"'></div>";
						returncontent += "<div class='snippitcontainer'><b>"+decodeURIComponent(datastream.returndata.record.LOCATION)+"</b> - "+decodeURIComponent(datastream.returndata.record.PARAGRAPH1)+"</div>";
						returncontent += "<a href='#pg_storydetails?"+decodeURIComponent(datastream.returndata.record.SKU)+"' class='ui-btn ui-btn-inline ui-icon-carat-r ui-btn-icon-right ui-mini'>Read More</a>"
						returncontent += "</div>"
						$("#"+datastream.contentbox).html(returncontent);
						
						
						break;
					case "headlines" :
					
						break;
					case "storydetails" :
					
						break;
				}
				break;
			default :
				//error - nonexistant function
				break;
		}
	}
	
	function getphoto(passedsrc) {
		
	}

loaddata("stories","topstory","eqADD1datarq%3Dyes%26STORYDATEtype%3Ddate%26STORYDATEsort%3D1%26STORYDATEsdir%3Dde%26max%3D1","main_topstory");


	if (history.length>1) {$('#back_btn').show();} else {$('#back_btn').hide();} //Contols the back btn

});
</script>

	
	
	<style>
	#headercontainer {
		background-image:url('img/headerbck.fw.png');
		background-repeat:repeat-x;
		background-position:center;
		width:100%;
		height:50px;
		position:fixed;
	}
	#headercontainer .logoimg {
		background-image:url('img/logo_lrg.fw.png');
		background-repeat:no-repeat;
		background-position:center;
		width:97px;
		height:86px;
		position:absolute;
		left:-3px;
		top:-6px;
	}
	
	</style>
	

	
</head>
<body marginheight="0" marginwidth="0" topmargin="0">

<div data-role="page" id="pg_index">
[include file=inc/pgheader.inc]
<div data-role="content">
<div id="main_topstory"></div>

</div>
</div>

<div data-role="page" id="pg_storydetails">
[include file=inc/pgheader.inc]
<div data-role="content">

</div>
</div>

<div data-role="page" id="pg_news">
[include file=inc/pgheader.inc]
<div data-role="content">

</div>
</div>

<div data-role="page" id="pg_weather">
[include file=inc/pgheader.inc]
<div data-role="content">

</div>
</div>

<div data-role="page" id="pg_weather_advisories">
[include file=inc/pgheader.inc]
<div data-role="content">

</div>
</div>


</body>
</html>